sudo: required

services:
 - docker

env:
 - PY_VER=3
 - PY_VER=2

script:
 - set -e
 - export PY_SFX="$([ "$PY_VER" == "2" ] && echo 2)"
 - docker pull ubuntu:16.04
 - ./build_image.sh "base${PY_SFX}"
 - docker run "oggm/base${PY_SFX}:travis-${TRAVIS_BUILD_NUMBER}" /bin/bash -c 'eval ${OGGM_DOCKER_TEST_COMMAND}'
 - ./build_image.sh "jupyter${PY_SFX}"

after_success:
 - set -e
 - docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
 - docker push "oggm/base${PY_SFX}"
 - docker push "oggm/jupyter${PY_SFX}"
